import streamlit as st
import random
import json
import os
import time
from datetime import datetime

# ==============================================================================
# 1. ×”×’×“×¨×•×ª ××¢×¨×›×ª ×•×¢×™×¦×•×‘ (CSS)
# ==============================================================================

st.set_page_config(
    page_title="×Ö²×—Ö¸×™×•Ö¼×ª - ×œ××™×“×” ×œ×˜×™×¤×•×œ × ××¨×¥ ×™×œ×“×™×",
    page_icon="ğŸ¥",
    layout="wide",
    initial_sidebar_state="expanded"
)

# ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×•×”××¨×ª ×˜×§×¡×˜ ×œ-HTML ×ª×§×™×Ÿ ×‘×¢×‘×¨×™×ª
def render_clean_html(text):
    """
    ×××™×¨ ×¤×•×¨××˜ ××¨×§×“××•×Ÿ ×‘×¡×™×¡×™ ×œ-HTML ××¢×•×¦×‘ ×•× ×§×™ ×›×“×™ ×œ×× ×•×¢ ×‘×¢×™×•×ª ×ª×¦×•×’×”.
    ××˜×¤×œ ×‘×›×•×›×‘×™×•×ª, ×™×¨×™×“×•×ª ×©×•×¨×” ×•×¨×©×™××•×ª.
    """
    html = text.replace("\n", "<br>")
    # ×”××¨×ª ×›×•×ª×¨×•×ª
    lines = html.split("<br>")
    formatted_lines = []
    in_list = False
    
    for line in lines:
        clean_line = line.strip()
        
        # ×›×•×ª×¨×•×ª
        if clean_line.startswith("###"):
            clean_line = f"<h3 style='color:#1565c0; margin-top:15px; border-bottom:1px solid #ddd;'>{clean_line.replace('###', '')}</h3>"
        elif clean_line.startswith("##"):
            clean_line = f"<h2 style='color:#0d47a1;'>{clean_line.replace('##', '')}</h2>"
        
        # ×”×“×’×©×•×ª (Bolding) - ×˜×™×¤×•×œ ×‘×›×•×›×‘×™×•×ª
        if "**" in clean_line:
            parts = clean_line.split("**")
            new_line = ""
            for i, part in enumerate(parts):
                if i % 2 == 1: # ×–×” ×”×˜×§×¡×˜ ×‘×™×Ÿ ×”×›×•×›×‘×™×•×ª
                    new_line += f"<span style='font-weight:bold; color:#2c3e50;'>{part}</span>"
                else:
                    new_line += part
            clean_line = new_line
            
        # ×¨×©×™××•×ª (Bullets)
        if clean_line.startswith("* ") or clean_line.startswith("- "):
            if not in_list:
                formatted_lines.append("<ul style='margin-right:20px;'>")
                in_list = True
            clean_line = f"<li>{clean_line[2:]}</li>"
        else:
            if in_list:
                formatted_lines.append("</ul>")
                in_list = False
                
        formatted_lines.append(clean_line)
    
    if in_list: formatted_lines.append("</ul>")
    
    final_html = "".join(formatted_lines)
    return f"""
    <div style="direction: rtl; text-align: right; font-family: 'Rubik', sans-serif; line-height: 1.6; font-size: 1.1rem; color: #333;">
        {final_html}
    </div>
    """

# ×”×–×¨×§×ª CSS ×’×œ×•×‘×œ×™
st.markdown("""
<style>
    @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap');
    
    html, body, .stApp {
        font-family: 'Rubik', sans-serif !important;
        background-color: #f4f7f6;
    }
    
    /* ×™×™×©×•×¨ ×’×œ×•×‘×œ×™ ×œ×™××™×Ÿ */
    .stMarkdown, .stButton, .stSelectbox, .stTextInput, p, h1, h2, h3, div {
        direction: rtl;
        text-align: right;
    }
    
    /* ×›×¨×˜×™×¡×™×•×ª (Cards) */
    .topic-card {
        background-color: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        border-top: 5px solid #3498db;
        transition: transform 0.2s;
        cursor: pointer;
        text-align: center;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify_content: center;
        align-items: center;
    }
    .topic-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        border-color: #2980b9;
    }
    
    /* ××–×•×¨ ×ª×•×›×Ÿ ×¨××©×™ */
    .content-container {
        background-color: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        border-right: 6px solid #2980b9;
        margin-bottom: 30px;
    }
    
    /* ××–×•×¨ ×¡×™××•×œ×¦×™×” */
    .sim-monitor {
        background-color: #000;
        color: #0f0;
        font-family: 'Courier New', monospace;
        padding: 15px;
        border-radius: 10px;
        border: 4px solid #333;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .sim-value { font-size: 1.8rem; font-weight: bold; }
    .sim-label { font-size: 0.8rem; color: #aaa; }
    
    /* ×›×¤×ª×•×¨×™× */
    .stButton button {
        width: 100%;
        border-radius: 8px;
        font-weight: 600;
        padding: 10px;
    }
    
    /* ×”×¡×ª×¨×ª ×œ×•×’×• ×¡×˜×¨×™××œ×™×˜ */
    #MainMenu {visibility: hidden;}
    footer {visibility: hidden;}
    
</style>
""", unsafe_allow_html=True)


# ==============================================================================
# 2. ×××’×¨ ×”×™×“×¢ ×”××œ× (The Knowledge Base)
# ==============================================================================
# ×”×§×¤×“×ª×™ ×œ××œ× ××ª ×›×œ ×”× ×•×©××™× ××”×§×‘×¦×™× ×©×©×œ×—×ª

FULL_DB = {
    "××¦×‘×™ ×—×™×¨×•× ×•×”×—×™×™××” ğŸš‘": {
        "description": "×¤×¨×•×˜×•×§×•×œ×™ ×”×—×™×™××” (PALS), ×©×•×§, ×•×˜×¨××•××”.",
        "subcategories": {
            "×©×•×§ (Shock)": {
                "×©×•×§ ×”×™×¤×•×•×œ××™": {
                    "text": """
                    ## ×©×•×§ ×”×™×¤×•×•×œ××™ / ×”××•×¨×’×™
                    **×”×’×“×¨×”:** ×¤×¨×¤×•×–×™×” ×œ×§×•×™×” ×¢×§×‘ ××•×‘×“×Ÿ × ×¤×—. ×”×’×•×¨× ×”×©×›×™×— ×‘×™×•×ª×¨ ×œ×©×•×§ ×‘×™×œ×“×™×.
                    
                    ### ×¡×™×× ×™× ×§×œ×™× ×™×™× (×œ×¤×™ ×—×•××¨×”):
                    * **×¤×™×¦×•×™ (Compensated):** ×“×•×¤×§ ××”×™×¨, ××™×œ×•×™ ×§×¤×™×œ×¨×™ > 2 ×©× ×™×•×ª, ×’×¤×™×™× ×§×¨×™×¨×•×ª. ×œ×—×¥ ×“× ×ª×§×™×Ÿ!
                    * **×‘×œ×ª×™ ××¤×¦×” (Decompensated):** ×™×¨×™×“×ª ×œ×—×¥ ×“× (×¡×™××Ÿ ×××•×—×¨!), ×©×™× ×•×™ ×‘××¦×‘ ×”×›×¨×”, ××™×¢×•×˜ ×©×ª×Ÿ, ×¢×•×¨ ×©×™×©.
                    * **×‘×œ×ª×™ ×”×¤×™×š:** ×‘×¨×“×™×§×¨×“×™×”, ×§×¨×™×¡×” ×§×¨×“×™×•×•×¡×§×•×œ×¨×™×ª.
                    
                    ### × ×™×”×•×œ ×•×˜×™×¤×•×œ:
                    1. **× ×ª×™×‘ ××•×•×™×¨:** ×—××¦×Ÿ 100%.
                    2. **×’×™×©×”:** ×©× ×™ ×•× ×¤×œ×•× ×™× ×¢×‘×™× ××• IO.
                    3. **× ×•×–×œ×™×:** ×‘×•×œ×•×¡ ×§×¨×™×¡×˜×œ×•××™×“×™× (×¡×œ×™×™×Ÿ/×”×¨×˜××Ÿ) **20 ×"×œ/×§"×’**.
                       * × ×™×ª×Ÿ ×œ×—×–×•×¨ ×¢×“ 3 ×¤×¢××™× (×¡×”"×› 60 ×"×œ/×§"×’).
                       * ×™×© ×œ×ª×ª ××”×™×¨ (×ª×•×š 5-10 ×“×§×•×ª) ×‘×©×™×˜×ª Push-Pull ××• ×©×§×™×ª ×œ×—×¥.
                    4. **×“×:** ×× ××™×Ÿ ×ª×’×•×‘×” ×œ× ×•×–×œ×™× ××• ×—×©×“ ×œ×“×™××•× -> ×× ×ª ×“× (PC) **10 ×"×œ/×§"×’**.
                    """,
                    "image": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Capillary_refill.gif/220px-Capillary_refill.gif"
                },
                "×©×•×§ ×¡×¤×˜×™": {
                    "text": """
                    ## ×¡×¤×¡×™×¡ ×•×©×•×§ ×¡×¤×˜×™
                    **SIRS:** ×—×•×/×”×™×¤×•×ª×¨××™×” + ×˜×›×™×§×¨×“×™×”/×˜×›×™×¤× ×™××” + ×œ×•×™×§×•×¦×™×˜×•×–×™×¡/×¤× ×™×”.
                    **×©×•×§ ×¡×¤×˜×™:** ×¡×¤×¡×™×¡ ×¢× ×ª×ª ×œ×—×¥ ×“× ×©×œ× ××’×™×‘ ×œ× ×•×–×œ×™×.
                    
                    ### ×—×‘×™×œ×ª ×”×˜×™×¤×•×œ (The Golden Hour):
                    1. **×—××¦×Ÿ ×•× ×™×˜×•×¨:** ××™×™×“×™.
                    2. **×’×™×©×” ×•×¨×™×“×™×ª/IO:** ×ª×•×š 5 ×“×§×•×ª.
                    3. **× ×•×–×œ×™×:** 20 ×"×œ/×§"×’ ×‘×•×œ×•×¡ (×¢×“ 60 ×"×œ/×§"×’). ×–×”×™×¨×•×ª ×‘×¡×™×× ×™ ××™ ×¡×¤×™×§×ª ×œ×‘ (Rales, ×›×‘×“ ××•×’×“×œ).
                    4. **×× ×˜×™×‘×™×•×˜×™×§×”:** ×¨×—×‘×ª ×˜×•×•×— (×œ××©×œ Meropenem 20-40 mg/kg) **×ª×•×š ×©×¢×”!**
                    5. **××™× ×•×˜×¨×•×¤×™×:**
                       * **×©×•×§ ×§×¨ (Cold):** ××“×¨× ×œ×™×Ÿ (0.05-0.3 mcg/kg/min).
                       * **×©×•×§ ×—× (Warm):** × ×•×¨××“×¨× ×œ×™×Ÿ (0.05-0.3 mcg/kg/min).
                    6. **×”×™×“×¨×•×§×•×¨×˜×™×–×•×Ÿ:** ×œ×©×§×•×œ ×‘×©×•×§ ×¢××™×“ ×œ×§×˜×›×•×œ××™× ×™× (×—×©×“ ×œ××™ ×¡×¤×™×§×ª ××“×¨× ×œ).
                    """,
                    "image": ""
                },
                "×× ×¤×™×œ×§×¡×™×¡": {
                    "text": """
                    ## ×× ×¤×™×œ×§×¡×™×¡
                    ×ª×’×•×‘×” ××œ×¨×’×™×ª ×¨×‘-××¢×¨×›×ª×™×ª ××¡×›× ×ª ×—×™×™×.
                    
                    ### ×˜×™×¤×•×œ ××¦×™×œ ×—×™×™× (××™×™×“×™!):
                    1. **××“×¨× ×œ×™×Ÿ IM:**
                       * ××™× ×•×Ÿ: **0.01 ×"×’/×§"×’**.
                       * ×¨×™×›×•×–: **1:1,000** (×œ× ××“×•×œ×œ).
                       * ××§×¡×™××•× ×œ×× ×”: 0.5 ×"×’.
                       * ××™×§×•×: ×©×¨×™×¨ ×”×™×¨×š (Vastus Lateralis).
                       * ×—×–×¨×”: ×›×œ 5-15 ×“×§×•×ª.
                    
                    ### ×˜×™×¤×•×œ ×ª×•××š:
                    * **× ×•×–×œ×™×:** 20 ×"×œ/×§"×’ (×œ×”×™×¤×•×˜× ×©×Ÿ ×‘×’×œ×œ ×“×œ×™×¤×” ×§×¤×™×œ×¨×™×ª).
                    * **×•× ×˜×•×œ×™×Ÿ:** ××™× ×”×œ×¦×™×” ×œ×¦×¤×¦×•×¤×™×.
                    * **×¡×˜×¨×•××™×“×™× ×•×× ×˜×™×”×™×¡×˜××™× ×™×:** ×˜×™×¤×•×œ ×§×• ×©× ×™ ×‘×œ×‘×“ (×œ×× ×™×¢×ª Biphasic Reaction).
                    """,
                    "image": ""
                }
            },
            "×”×—×™×™××” (PALS)": {
                "×¤×¨×•×˜×•×§×•×œ ×”×—×™×™××”": {
                    "text": """
                    ## ×”×—×™×™××ª ×™×œ×“×™× ××ª×§×“××ª (PALS)
                    
                    ### ×™×¡×•×“×•×ª:
                    * **×¢×™×¡×•×™×™×:** ×¢×•××§ 1/3 ××‘×™×ª ×”×—×–×” (4 ×¡"× ×‘×ª×™× ×•×§, 5 ×‘×™×œ×“). ×§×¦×‘ 100-120.
                    * **×™×—×¡:** 15:2 (×©× ×™ ××˜×¤×œ×™×).
                    
                    ### ×ª×¨×•×¤×•×ª:
                    * **××“×¨× ×œ×™×Ÿ:** 0.01 ×"×’/×§"×’ (0.1 ×"×œ/×§"×’ ××“×™×œ×•×œ 1:10,000). ×›×œ 3-5 ×“×§×•×ª.
                    * **×××™××•×“×•×¨×•×Ÿ:** 5 ×"×’/×§"×’ (×‘-VF/pVT ×¢××™×“).
                    * **×œ×™×“×•×§××™×Ÿ:** 1 ×"×’/×§"×’.
                    
                    ### ×©×•×§ ×—×©××œ×™ (Defibrillation):
                    * ××™× ×“×™×§×¦×™×”: VF ××• Pulseless VT.
                    * ×× ×” ×¨××©×•× ×”: **2 J/kg**.
                    * ×× ×” ×©× ×™×”: **4 J/kg**.
                    * ×× ×•×ª ×”×‘××•×ª: ×¢×“ 10 J/kg.
                    
                    ### ×”×¤×™×›×™× (H's & T's):
                    * **H:** Hypovolemia, Hypoxia, Hydrogen ion (Acidosis), Hypo/Hyperkalemia, Hypothermia.
                    * **T:** Tension pneumothorax, Tamponade, Toxins, Thrombosis (Pulmonary/Coronary).
                    """,
                    "image": ""
                }
            }
        }
    },
    "×ª×¨×•×¤×•×ª ×•×¤×¨××§×•×œ×•×’×™×” ğŸ’Š": {
        "description": "××™× ×•× ×™×, ×¡×“×¦×™×”, ××™× ×•×˜×¨×•×¤×™× ×•××œ×§×˜×¨×•×œ×™×˜×™×.",
        "subcategories": {
            "×¡×“×¦×™×” ×•×× ×œ×’×–×™×”": {
                "××™×“×–×•×œ× (Dormicum)": {
                    "text": """
                    ## ××™×“×–×•×œ× (Midazolam)
                    ×‘× ×–×•×“×™××–×¤×™×Ÿ. ××©××© ×œ×”×¨×’×¢×” ×•× ×•×’×“ ×¤×¨×›×•×¡.
                    
                    ### ××™× ×•× ×™×:
                    * **IV/IM:** ××™× ×•×Ÿ 0.05-0.1 ×"×’/×§"×’.
                    * **×¤×•×©:** ×œ×ª×ª ×œ××˜ (×¡×›× ×ª ×“×•× × ×©×™××”).
                    * **×“×¨×™×¤:** 1-4 ××™×§×¨×•×’×¨×/×§"×’/×“×§×”.
                    
                    ### ×“×’×©×™×:
                    * ×–×”×™×¨×•×ª ×‘×ª×™× ×•×§×•×ª ××ª×—×ª ×œ-6 ×—×•×“×©×™×.
                    * **×× ×˜×™×“×•×˜:** ×¤×œ×•××–× ×™×œ (Flumazenil).
                    """,
                    "image": ""
                },
                "×§×˜××™×Ÿ (Ketamine)": {
                    "text": """
                    ## ×§×˜××™×Ÿ (Ketamine)
                    ×”×¨×“××” ×“×™×¡×•×¦×™××˜×™×‘×™×ª.
                    
                    ### ×™×ª×¨×•× ×•×ª ×‘-PICU:
                    * ×©×•××¨ ×¢×œ ×¨×¤×œ×§×¡ × ×©×™××”.
                    * ××¢×œ×” ×œ×—×¥ ×“× ×•×“×•×¤×§ (×¡×™××¤×˜×•××™××˜×™) - **××¦×•×™×Ÿ ×œ×©×•×§**.
                    * ××¨×—×™×‘ ×¡×™××¤×•× ×•×ª (×˜×•×‘ ×œ××¡×˜××”).
                    
                    ### ××™× ×•× ×™×:
                    * **××™× ×˜×•×‘×¦×™×”/×”×—×™×™××”:** 1-2 ×"×’/×§"×’ IV.
                    * **×¡×“×¦×™×” ×œ×¤×¨×•×¦×“×•×¨×”:** 1 ×"×’/×§"×’.
                    
                    ### ×ª×•×¤×¢×•×ª ×œ×•×•××™:
                    * ×¨×™×•×¨ (Sialorrhea) - × ×™×ª×Ÿ ×œ×©×œ×‘ ××˜×¨×•×¤×™×Ÿ.
                    * ×”×–×™×•×ª ×‘×”×ª×¢×•×¨×¨×•×ª.
                    * ×œ×¨×™× ×’×•×¡×¤××–× (× ×“×™×¨).
                    """,
                    "image": ""
                },
                "×¨×•×§×•×¨×•× ×™×•× (Esmeron)": {
                    "text": """
                    ## ×¨×•×§×•×¨×•× ×™×•× (Rocuronium)
                    ××©×ª×§ ×©×¨×™×¨×™× (Non-depolarizing).
                    
                    ### ××™× ×“×™×§×¦×™×”:
                    ××™× ×˜×•×‘×¦×™×” ××”×™×¨×” (RSI) ××• ×¦×•×¨×š ×‘×©×™×ª×•×§ ×œ×”× ×©××”.
                    
                    ### ××™× ×•×Ÿ:
                    * **××™× ×˜×•×‘×¦×™×”:** 1 ×"×’/×§"×’ (××ª×Ÿ ××”×™×¨).
                    * ×–××Ÿ ×”×©×¤×¢×”: 30-40 ×©× ×™×•×ª.
                    
                    ### ××–×”×¨×” ×—××•×¨×”:
                    **×—×•×‘×” ×œ×ª×ª ×¡×“×¦×™×” ×œ×¤× ×™ ×”××©×ª×§!** (×”××˜×•×¤×œ ×¢×¨ ××š ×œ× ×™×›×•×œ ×œ×–×•×– ××• ×œ× ×©×•×).
                    """,
                    "image": ""
                }
            },
            "×§×¨×“×™××œ×™ ×•××™× ×•×˜×¨×•×¤×™×": {
                "××“× ×•×–×™×Ÿ (Adenosine)": {
                    "text": """
                    ## ××“× ×•×–×™×Ÿ
                    ×ª×¨×•×¤×ª ×”×‘×—×™×¨×” ×œ-SVT.
                    
                    ### ××•×¤×Ÿ ××ª×Ÿ (×§×¨×™×˜×™):
                    * ×–××Ÿ ××—×¦×™×ª ×—×™×™× ×©×œ ×©× ×™×•×ª ×‘×•×“×“×•×ª.
                    * **×©×™×˜×ª Push-Flush:** ×”×–×¨×§×” ××”×™×¨×” ×××•×“ ×‘×‘×¨×– ×”×›×™ ×§×¨×•×‘ ×œ×œ×‘ -> ××™×“ ×©×˜×™×¤×” ×‘×•×œ×•×¡ 5-10 ×"×œ ×¡×œ×™×™×Ÿ -> ×”×¨××ª ×”×™×“.
                    
                    ### ××™× ×•× ×™×:
                    1. ×× ×” ×¨××©×•× ×”: **0.1 ×"×’/×§"×’** (××§×¡' 6 ×"×’).
                    2. ×× ×” ×©× ×™×”: **0.2 ×"×’/×§"×’** (××§×¡' 12 ×"×’).
                    
                    ### ×ª×•×¤×¢×•×ª ×œ×•×•××™:
                    ×”×¨×’×©×ª "×‘×¢×™×˜×”" ×‘×—×–×”, ×”×¡××§×”, Asystole ×¨×’×¢×™×ª ×‘××•× ×™×˜×•×¨.
                    """,
                    "image": ""
                },
                "××“×¨× ×œ×™×Ÿ (Adrenaline)": {
                    "text": """
                    ## ××“×¨× ×œ×™×Ÿ (Epinephrine)
                    
                    ### ××™× ×•× ×™× ×•×¨×™×›×•×–×™× (×‘×œ×‘×•×œ ××¡×•×›×Ÿ!):
                    * **×”×—×™×™××” (IV/IO):** 0.01 ×"×’/×§"×’. ×“×™×œ×•×œ **1:10,000**. (×›×œ×•××¨ 0.1 ×"×œ/×§"×’).
                    * **×× ×¤×™×œ×§×¡×™×¡ (IM):** 0.01 ×"×’/×§"×’. ×“×™×œ×•×œ **1:1,000**.
                    * **××™× ×”×œ×¦×™×” (×¡×˜×¨×™×“×•×¨):** 0.5 ×"×œ/×§"×’ (××§×¡' 5 ×"×œ).
                    * **×“×¨×™×¤ (Inotrope):** 0.05 - 1.0 mcg/kg/min.
                    """,
                    "image": ""
                }
            },
            "××œ×§×˜×¨×•×œ×™×˜×™×": {
                "×ª×™×§×•×Ÿ ××©×œ×’×Ÿ ×•××’× ×–×™×•×": {
                    "text": """
                    ## ×ª×™×§×•×Ÿ ××œ×§×˜×¨×•×œ×™×˜×™×
                    
                    ### ××©×œ×’×Ÿ (K):
                    * **×”×™×¤×•×§×œ××™×”:** ××ª×Ÿ PO ×¢×“×™×£. ×‘-IV ×§×¦×‘ ××§×¡×™××œ×™ 0.5-1 mEq/kg/h ×ª×—×ª × ×™×˜×•×¨.
                    * **×”×™×¤×¨×§×œ××™×” (×—×™×¨×•×):**
                      1. **×§×œ×¦×™×•× ×’×œ×•×§×•× ×˜:** ×”×’× ×” ×¢×œ ×”×œ×‘ (Cardioprotection).
                      2. **××™× ×¡×•×œ×™×Ÿ + ×’×œ×•×§×•×–:** ×”×›× ×¡×ª ××©×œ×’×Ÿ ×œ×ª××™×.
                      3. **×•× ×˜×•×œ×™×Ÿ:** ××™× ×”×œ×¦×™×”.
                      4. **×¤×•×¡×™×“/×§×™×™×§×¡×œ××˜:** ×¤×™× ×•×™ ××”×’×•×£.
                    
                    ### ××’× ×–×™×•× (Mg):
                    * **×—×•×§ ×—×©×•×‘:** ×”×™×¤×•××’× ×–××™×” ×’×•×¨××ª ×œ×”×™×¤×•×§×œ××™×” ×¢××™×“×” ×œ×˜×™×¤×•×œ. ×™×© ×œ×ª×§×Ÿ ××’× ×–×™×•× ×§×•×“×!
                    * ××™× ×•×Ÿ ××’× ×–×™×•× ×¡×•×œ×¤×˜: 25-50 ×"×’/×§"×’ (IV ××™×˜×™).
                    """,
                    "image": ""
                }
            }
        }
    },
    "×”××•×˜×•-××•× ×§×•×œ×•×’×™×” ğŸ©¸": {
        "description": "×œ×•×§××™×”, ××•×¦×¨×™ ×“×, TLS.",
        "subcategories": {
            "×œ×•×§××™×” ×•×¤×× ×¦×™×˜×•×¤× ×™×”": {
                "×¤×× ×¦×™×˜×•×¤× ×™×”": {
                    "text": """
                    ## ×¤×× ×¦×™×˜×•×¤× ×™×”
                    ×™×¨×™×“×” ×‘×›×œ ×©×•×¨×•×ª ×”×“×: ×× ××™×” (RBC), ×œ×•×™×§×•×¤× ×™×” (WBC), ×˜×¨×•××‘×•×¦×™×˜×•×¤× ×™×” (PLT).
                    
                    ### ×’×•×¨××™× ×¢×™×§×¨×™×™×:
                    * **×œ×•×§××™×” (ALL/AML):** ×—×“×™×¨×ª ×ª××™× ××××™×¨×™× ×œ××— ×”×¢×¦×. ×¡×™×× ×™×: ×›××‘×™ ×¢×¦××•×ª, ×”×’×“×œ×ª ×›×‘×“/×˜×—×•×œ, ×—×•×, ×“×™××•××™×.
                    * **×× ××™×” ××¤×œ×¡×˜×™×ª:** ×›×©×œ ×©×œ ××— ×”×¢×¦× (××™×“×™×•×¤×ª×™, ×ª×¨×•×¤×•×ª, ×•×™×¨×•×¡×™×).
                    
                    ### ×“×’×©×™× ×‘×˜×™×¤×•×œ × ××¨×¥:
                    * **×‘×™×“×•×“ ××’×Ÿ:** ×‘×—×•×œ×™× × ×•×™×˜×¨×•×¤× ×™× (Neutrophil count < 500).
                    * **×—×•× ×‘× ×•×™×˜×¨×•×¤× ×™×”:** ××¦×‘ ×—×™×¨×•×! ×“×•×¨×© ×ª×¨×‘×™×•×ª ×•×× ×˜×™×‘×™×•×˜×™×§×” ××™×™×“×™×ª (×›×™×¡×•×™ ×œ×¤×¡××•×“×•××•× ×¡).
                    """,
                    "image": ""
                },
                "Tumor Lysis Syndrome": {
                    "text": """
                    ## Tumor Lysis Syndrome (TLS)
                    ××¦×‘ ×—×™×¨×•× ××•× ×§×•×œ×•×’×™ ×”× ×•×‘×¢ ××¤×™×¨×•×§ ××¡×™×‘×™ ×©×œ ×ª××™ ×’×™×“×•×œ (×¡×¤×•× ×˜× ×™ ××• ××—×¨×™ ×›×™××•).
                    
                    ### ×”×¤×¨×¢×•×ª ××˜×‘×•×œ×™×•×ª (×”×™×¤×¨×™×):
                    * **×”×™×¤×¨-××•×¨×™×¦××™×”** (×—×•××¦×” ××•×¨×™×ª) -> × ×–×§ ×›×œ×™×ª×™.
                    * **×”×™×¤×¨-×§×œ××™×”** -> ×”×¤×¨×¢×•×ª ×§×¦×‘ ×•××•×•×ª.
                    * **×”×™×¤×¨-×¤×•×¡×¤×˜××™×”** -> ×’×•×¨××ª ×œ×”×™×¤×•-×§×œ×¦××™×”.
                    
                    ### ×× ×™×¢×” ×•×˜×™×¤×•×œ:
                    1. **×”×™×“×¨×¦×™×” ××’×¨×¡×™×‘×™×ª:** ×©×˜×™×¤×ª ×”×›×œ×™×•×ª (×¤×™ 2-3 ××”×ª×—×–×•×§×”), ×œ×œ× ××©×œ×’×Ÿ ×‘× ×•×–×œ×™×!
                    2. **××œ×•×¤×¨×™× ×•×œ:** ×× ×™×¢×ª ×™×™×¦×•×¨ ×—×•××¦×” ××•×¨×™×ª.
                    3. **×¨×¡×‘×•×¨×™×§×– (Rasburicase):** ××¤×¨×§ ×—×•××¦×” ××•×¨×™×ª. **××¡×•×¨ ×‘×—×•×œ×™ G6PD!**
                    4. ×˜×™×¤×•×œ ×‘×”×™×¤×¨×§×œ××™×”.
                    """,
                    "image": ""
                }
            },
            "××•×¦×¨×™ ×“×": {
                "× ×•×”×œ ××ª×Ÿ ××•×¦×¨×™ ×“×": {
                    "text": """
                    ## ××ª×Ÿ ××•×¦×¨×™ ×“×
                    
                    ### ×“× ××œ× (Packed Cells):
                    * **××™× ×•×Ÿ:** 10-15 ×"×œ/×§"×’ (××¢×œ×” ×”××•×’×œ×•×‘×™×Ÿ ×‘-2-3 ×’×¨×).
                    * **×§×¦×‘:** ×‘××©×š 2-4 ×©×¢×•×ª (×‘×“×™××•× ×¤×¢×™×œ - ×‘×•×œ×•×¡).
                    * ×—×•×‘×” ×œ×”×©×ª××© ×‘×¡×˜ ×¢× ×¤×™×œ×˜×¨.
                    
                    ### ×˜×¡×™×•×ª (Platelets):
                    * **××™× ×•×Ÿ:** 5-10 ×"×œ/×§"×’.
                    * **××™× ×“×™×§×¦×™×”:** ×¡×¤×™×¨×” < 10,000 ××• < 50,000 ×¢× ×“×™××•×.
                    * **×“×’×© ×§×¨×™×˜×™:** ××™×Ÿ ×œ×ª×ª ×“×¨×š ××©××‘×” (IVAC) - ×”×× ×’× ×•×Ÿ ×”×•×¨×¡ ××ª ×”×˜×¡×™×•×ª. ×œ×ª×ª ×‘×’×¨×‘×™×˜×¦×™×” ××• ×¤×•×© ×¢×“×™×Ÿ.
                    
                    ### ×¤×œ×–××” (FFP):
                    * ××›×™×œ ×¤×§×˜×•×¨×™ ×§×¨×™×©×”.
                    * ××™× ×“×™×§×¦×™×”: DIC, ××—×œ×ª ×›×‘×“, ×“×™××•× ××¡×™×‘×™.
                    """,
                    "image": ""
                }
            }
        }
    },
    "× ×•×™×¨×•×œ×•×’×™×” ×•×˜×¨××•××” ğŸ§ ": {
        "description": "TBI, ×¤×¨×›×•×¡×™×, ×× ×™× ×’×™×˜×™×¡.",
        "subcategories": {
            "×˜×¨××•××ª ×¨××© (TBI)": {
                "× ×™×”×•×œ ICP ××•×’×‘×¨": {
                    "text": """
                    ## × ×™×”×•×œ ×—×‘×œ×ª ×¨××© (TBI)
                    **×”××˜×¨×”:** ×©××™×¨×” ×¢×œ CPP (Cerebral Perfusion Pressure).
                    `CPP = MAP - ICP`
                    
                    ### ×¡×™×× ×™ ×™×ª×¨ ×œ×—×¥ ×ª×•×š ×’×•×œ×’×•×œ×ª×™ (ICP):
                    * ×›××‘×™ ×¨××©, ×”×§××•×ª, ×™×¨×™×“×” ×‘×”×›×¨×”.
                    * **Cushing Triad (×”×¨× ×™××¦×™×”):** ×™×ª×¨ ×œ"×“ + ×‘×¨×“×™×§×¨×“×™×” + × ×©×™××” ×œ× ×¡×“×™×¨×”.
                    
                    ### ×˜×™×¤×•×œ ×œ×”×•×¨×“×ª ICP:
                    1. **×ª× ×•×—×”:** ×”×¨××ª ××¨××©×•×ª 30 ××¢×œ×•×ª, ×¨××© ×™×©×¨ (×œ× ×—×•×¡× ×•×¨×™×“×™ ×¦×•×•××¨).
                    2. **×¡×œ×™×™×Ÿ ×”×™×¤×¨×˜×•× ×™ 3%:** 3-5 ×"×œ/×§"×’ ×‘×•×œ×•×¡ (××• ×“×¨×™×¤).
                    3. **×× ×™×˜×•×œ:** 0.5-1 ×’×¨×/×§"×’ (×× ××•×¡××•×œ×¨×™×•×ª < 320).
                    4. **×”×™×¤×¨×•×•× ×˜×™×œ×¦×™×”:** ××ª×•× ×” (PCO2 30-35) - ×¨×§ ×›××•×¦× ××—×¨×•×Ÿ ×‘×”×¨× ×™××¦×™×” ×¤×¢×™×œ×”.
                    """,
                    "image": ""
                }
            },
            "×¤×¨×›×•×¡×™×": {
                "×¡×˜×˜×•×¡ ××¤×™×œ×¤×˜×™×§×•×¡": {
                    "text": """
                    ## ×¡×˜×˜×•×¡ ××¤×™×œ×¤×˜×™×§×•×¡
                    ×¤×¨×›×•×¡ ×”× ××©×š > 5 ×“×§×•×ª ××• ×¤×¨×›×•×¡×™× ×—×•×–×¨×™× ×œ×œ× ×—×–×¨×” ×œ×”×›×¨×”.
                    
                    ### ×¤×¨×•×˜×•×§×•×œ ×˜×™×¤×•×œ:
                    1. **ABC:** ×—××¦×Ÿ, ×’×œ×•×§×•×– (×œ×©×œ×•×œ ×”×™×¤×•×’×œ×™×§××™×”).
                    2. **×§×• ×¨××©×•×Ÿ (×‘× ×–×•×“×™××–×¤×™× ×™×):**
                       * ××™×“×–×•×œ× IV (0.1 ×"×’/×§"×’) ××• IM/Buccal.
                       * ×“×™××–×¤× (×•××œ×™×•×) IV.
                    3. **×§×• ×©× ×™ (×”×¢××¡×”):**
                       * **×¤× ×™×˜×•××™×Ÿ (Epanutin):** 20 ×"×’/×§"×’. **×—×•×‘×” ×‘×¡×œ×™×™×Ÿ ×‘×œ×‘×“!** (××ª×’×‘×© ×‘×’×œ×•×§×•×–), ×“×•×¨×© ×¤×™×œ×˜×¨. ×§×¦×‘ ××™×˜×™ (×× ×™×¢×ª ×”×¤×¨×¢×•×ª ×§×¦×‘).
                       * **×œ×‘×˜×™×¨×¦×˜× (Keppra):** 20-40 ×"×’/×§"×’. ×‘×˜×•×— ×™×—×¡×™×ª.
                       * **×¤× ×•×‘×¨×‘×™×˜×œ:** ×‘×™×œ×•×“×™× ×•×ª×™× ×•×§×•×ª.
                    4. **×§×• ×©×œ×™×©×™ (×”×¨×“××”):** ××™×“×–×•×œ× ×“×¨×™×¤, ×ª×™×•×¤× ×˜×œ, ×¤×¨×•×¤×•×¤×•×œ, ×”×¨×“××” ×›×œ×œ×™×ª.
                    """,
                    "image": ""
                }
            },
            "××¦×‘×™× × ×•×¡×¤×™×": {
                "×× ×™× ×’×™×˜×™×¡ (×“×œ×§×ª ×§×¨×•× ×”××•×—)": {
                    "text": """
                    ## ×× ×™× ×’×™×˜×™×¡ (Meningitis)
                    **×¡×™×× ×™×:** ×—×•×, ×§×©×™×•×Ÿ ×¢×•×¨×£ (Kernig/Brudzinski), ×¤×•×˜×•×¤×•×‘×™×”, ×¤×˜×›×™×•×ª (×× ×™× ×’×•×§×•×§).
                    ×‘×ª×™× ×•×§×•×ª: ××¨×¤×¡ ×ª×¤×•×—, ××™ ×©×§×˜.
                    
                    ### ××‘×—× ×” ×•×˜×™×¤×•×œ:
                    1. **LP (× ×™×§×•×¨ ××•×ª× ×™):** ×œ×©×œ×™×—×ª ×ª×¨×‘×™×ª, ×—×œ×‘×•×Ÿ, ×¡×•×›×¨, ×ª××™×.
                       * *×§×•× ×˜×¨××™× ×“×™×§×¦×™×” ×œ-LP:* ICP ××•×’×‘×¨, ××™ ×™×¦×™×‘×•×ª, ×˜×¨×•××‘×•×¦×™×˜×•×¤× ×™×” ×§×©×”.
                    2. **×× ×˜×™×‘×™×•×˜×™×§×”:** ×¨×•×¦×¤×™×Ÿ (Ceftriaxone) ×‘××™× ×•×Ÿ ×× ×™× ×’×™××œ×™ (100 ×"×’/×§"×’/×™×•×) + ×•×× ×§×•××™×¦×™×Ÿ.
                    3. **×‘×™×“×•×“:** ×˜×™×¤×ª×™/××’×¢ ×¢×“ ×©×œ×™×œ×ª ×× ×™× ×’×•×§×•×§.
                    """,
                    "image": ""
                }
            }
        }
    },
     "×’×¡×˜×¨×•, ×ª×–×•× ×” ×•×›×œ×œ×™ ğŸ": {
        "description": "TPN, ×›×•×•×™×•×ª, ×”×¨×¢×œ×•×ª.",
        "subcategories": {
            "×ª×–×•× ×”": {
                "TPN (Total Parenteral Nutrition)": {
                    "text": """
                    ## ×”×–× ×” ×ª×•×š ×•×¨×™×“×™×ª (TPN)
                    × ×™×ª×Ÿ ×œ×™×œ×“×™× ×©×œ× ×™×›×•×œ×™× ×œ×§×‘×œ ×›×œ×›×œ×” ×× ×˜×¨×œ×™×ª (×“×¨×š ×”××¢×™) ×œ××•×¨×š ×–××Ÿ.
                    
                    ### ××¨×›×™×‘×™×:
                    * **×¤×—××™××•×ª:** ×“×§×¡×˜×¨×•×– (××§×•×¨ ×× ×¨×’×™×” ×¢×™×§×¨×™).
                    * **×—×œ×‘×•× ×™×:** ×—×•××¦×•×ª ×××™× ×•.
                    * **×©×•×× ×™× (Lipids):** ××™× ×˜×¨×œ×™×¤×™×“/SMOF.
                    * **××œ×§×˜×¨×•×œ×™×˜×™×:** × ×ª×¨×Ÿ, ××©×œ×’×Ÿ, ×¡×™×“×Ÿ, ×–×¨×—×Ÿ, ××’× ×–×™×•×.
                    * **×•×™×˜××™× ×™× ×•×™×¡×•×“×•×ª ×§×•×¨×˜.**
                    
                    ### ×¡×™×‘×•×›×™×:
                    1. **×–×™×”×•× ×¦× ×ª×¨ (CLABSI):** ×”×¡×™×‘×•×š ×”××¡×•×›×Ÿ ×‘×™×•×ª×¨. ×ª××™×¡×” ×¢×©×™×¨×” ×‘×¡×•×›×¨ ×”×™× ×§×¨×§×¢ ×œ×—×™×™×“×§×™×.
                    2. **××˜×‘×•×œ×™:** ×”×™×¤×•/×”×™×¤×¨×’×œ×™×§××™×”, ×”×¤×¨×¢×•×ª ××œ×§×˜×¨×•×œ×™×˜×¨×™×•×ª.
                    3. **Refeeding Syndrome:** ×‘×™×œ×“×™× ×‘×ª×ª-×ª×–×•× ×”. × ×¤×™×œ×” ×—×“×” ×©×œ ×–×¨×—×Ÿ, ××©×œ×’×Ÿ ×•××’× ×–×™×•× ×¢× ×”×ª×—×œ×ª ×”×”×–× ×”. ×¡×›× ×ª ×—×™×™×!
                    4. **×›×‘×“:** ×›×•×œ×¡×˜××–×™×¡ ×‘×©×™××•×© ×××•×©×š (Fat overload).
                    """,
                    "image": ""
                }
            },
            "×˜×¨××•××” ××™×•×—×“×ª": {
                "×›×•×•×™×•×ª (Burns)": {
                    "text": """
                    ## ×›×•×•×™×•×ª ×•×˜×™×¤×•×œ ×‘× ×•×–×œ×™×
                    **×”×¢×¨×›×ª ×©×˜×— ×›×•×•×™×”:** ×—×•×§ ×”-9 (×©×•× ×” ×‘×™×œ×“×™× - ×¨××© ×’×“×•×œ ×™×•×ª×¨).
                    
                    ### × ×•×¡×—×ª ×¤×¨×§×œ× ×“ (Parkland Formula):
                    ×—×™×©×•×‘ × ×•×–×œ×™× ×œ-24 ×©×¢×•×ª ×¨××©×•× ×•×ª:
                    `4 ×"×œ * ××©×§×œ (×§"×’) * % ×©×˜×— ×›×•×•×™×”`
                    * ×—×¦×™ ××”×›××•×ª ×‘-8 ×©×¢×•×ª ×¨××©×•× ×•×ª.
                    * ×”×—×¦×™ ×”×©× ×™ ×‘-16 ×©×¢×•×ª ×”×‘××•×ª.
                    * ×‘× ×•×¡×£ ×™×© ×œ×ª×ª × ×•×–×œ×™ ××—×–×§×” ×¨×’×™×œ×™× (Maintenance) ×‘×™×œ×“×™×!
                    
                    ### ×“×’×©×™×:
                    * **× ×ª×™×‘ ××•×•×™×¨:** ×—×©×“ ×œ×¤×’×™×¢×ª ×©××™×¤×” (Inhalation injury) ×‘×›×•×•×™×•×ª ×¤× ×™×/×©×¨×™×¤×” ×‘×—×œ×œ ×¡×’×•×¨ -> ××™× ×˜×•×‘×¦×™×” ××•×§×“××ª (×œ×¤× ×™ ×‘×¦×§×ª).
                    * **×˜××¤×¨×˜×•×¨×”:** ×©××™×¨×” ×¢×œ ×—×•× ×’×•×£ (×™×œ×“×™× ×××‘×“×™× ×—×•× ××”×¨).
                    """,
                    "image": ""
                },
                "×”×¨×¢×œ×•×ª": {
                    "text": """
                    ## ×”×¨×¢×œ×•×ª × ×¤×•×¦×•×ª ×‘×™×œ×“×™×
                    
                    ### ×¢×§×¨×•× ×•×ª:
                    * ABC ×•×™×™×¦×•×‘.
                    * ×× ×™×¢×ª ×¡×¤×™×’×” (×¤×—× ×¤×¢×™×œ - ×ª×•×š ×©×¢×”).
                    * ×× ×˜×™×“×•×˜×™×.
                    
                    ### ×”×¨×¢×œ×•×ª ×¡×¤×¦×™×¤×™×•×ª:
                    * **××§××•×œ (Paracetamol):** ×¤×’×™×¢×” ×›×‘×“×™×ª. ×¨××•×ª ×‘×“× ××—×¨×™ 4 ×©×¢×•×ª. ×× ×˜×™×“×•×˜: **NAC (Mucomyst)**.
                    * **××•×¤×™××˜×™×:** ×“×™×›×•×™ × ×©×™××ª×™, ××™×©×•× ×™ ×¡×™×›×”. ×× ×˜×™×“×•×˜: **× ×œ×•×§×¡×•×Ÿ (Narcan)**.
                    * **×‘× ×–×•×“×™××–×¤×™× ×™×:** ×™×©× ×•× ×™×•×ª. ×× ×˜×™×“×•×˜: **×¤×œ×•××–× ×™×œ** (×–×”×™×¨×•×ª ×‘×¤×¨×›×•×¡×™× ×›×¨×•× ×™×™×).
                    * **×—×•××¨×™ ×”×“×‘×¨×” (××•×¨×’× ×•×¤×•×¡×¤×˜×™×):** ×¨×™×•×¨, ×“××¢×ª, ×©×œ×©×•×œ, ×‘×¨×“×™×§×¨×“×™×”. ×˜×™×¤×•×œ: **××˜×¨×•×¤×™×Ÿ**.
                    """,
                    "image": ""
                }
            }
        }
    }
}

# ×©××œ×•×ª ×œ××‘×—×Ÿ (××“×’× ××ª×•×š ×”×××’×¨ ×”×’×“×•×œ)
ALL_QUESTIONS = [
    {"q": "××” ×”××™× ×•×Ÿ ×©×œ ××“×¨× ×œ×™×Ÿ IV ×‘×”×—×™×™××”?", "opts": ["0.01 ×\"×’/×§\"×’ (1:10,000)", "0.1 ×\"×’/×§\"×’", "1 ×\"×’/×§\"×’", "0.5 ×\"×’/×§\"×’"], "a": "0.01 ×\"×’/×§\"×’ (1:10,000)", "exp": "×“×™×œ×•×œ 1:10,000."},
    {"q": "××” ×”×¡×™×‘×•×š ×”×¢×™×§×¨×™ ×‘××ª×Ÿ ×¤× ×™×˜×•××™×Ÿ ×¢× ×’×œ×•×§×•×–?", "opts": ["×”×ª×’×‘×©×•×ª ×”×ª×¨×•×¤×”", "×”×™×¤×•×’×œ×™×§××™×”", "×™×ª×¨ ×œ×—×¥ ×“×", "××™×Ÿ ×‘×¢×™×”"], "a": "×”×ª×’×‘×©×•×ª ×”×ª×¨×•×¤×”", "exp": "×¤× ×™×˜×•××™×Ÿ ×œ× ×™×¦×™×‘ ×‘×’×œ×•×§×•×– ×•×©×•×§×¢. ×—×•×‘×” ×œ×ª×ª ×‘×¡×œ×™×™×Ÿ."},
    {"q": "××”×• ×”×˜×™×¤×•×œ ×”××™×™×“×™ ×‘×”×™×¤×¨×§×œ××™×” ×¢× ×©×™× ×•×™×™ ××§\"×’?", "opts": ["×§×œ×¦×™×•× ×’×œ×•×§×•× ×˜", "×¤×•×¡×™×“", "×§×™×™×§×¡×œ××˜", "×“×™××œ×™×–×”"], "a": "×§×œ×¦×™×•× ×’×œ×•×§×•× ×˜", "exp": "××™×™×¦×‘ ××ª ×××‘×¨× ×ª ×”×œ×‘ ×•××•× ×¢ VF."},
    {"q": "××” ×××¤×™×™×Ÿ Cushing Triad?", "opts": ["×™×ª\"×œ, ×‘×¨×“×™×§×¨×“×™×”, × ×©×™××” ×œ× ×¡×“×™×¨×”", "×ª×ª\"×œ, ×˜×›×™×§×¨×“×™×”, ×—×•×", "××™×©×•× ×™× ×¦×¨×™×", "×›××‘×™ ×‘×˜×Ÿ"], "a": "×™×ª\"×œ, ×‘×¨×“×™×§×¨×“×™×”, × ×©×™××” ×œ× ×¡×“×™×¨×”", "exp": "×¡×™××Ÿ ×œ-ICP ××•×’×‘×¨."},
    {"q": "××”×• ×”××™× ×•×Ÿ ×©×œ × ×•×–×œ×™× ×‘×©×•×§ ×”×™×¤×•×•×œ××™?", "opts": ["20 ×\"×œ/×§\"×’", "50 ×\"×œ/×§\"×’", "5 ×\"×œ/×§\"×’", "10 ×\"×œ/×§\"×’"], "a": "20 ×\"×œ/×§\"×’", "exp": "×‘×•×œ×•×¡ ××”×™×¨."},
    {"q": "××™×–×• ×ª×¨×•×¤×” ××¡×•×¨×” ×œ×©×™××•×© ×‘-TLS ×‘×—×•×œ×™ G6PD?", "opts": ["Rasburicase", "Allopurinol", "Furosemide", "Calcium"], "a": "Rasburicase", "exp": "×’×•×¨××ª ×œ×”××•×œ×™×–×” ×§×©×” ×‘×—×¡×¨ G6PD."},
    {"q": "×ª×•×š ×›××” ×–××Ÿ ×™×© ×œ×ª×ª ×× ×˜×™×‘×™×•×˜×™×§×” ×‘×¡×¤×¡×™×¡?", "opts": ["×ª×•×š ×©×¢×”", "×ª×•×š 4 ×©×¢×•×ª", "××—×¨×™ ×ª×©×•×‘×ª ×ª×¨×‘×™×ª", "×ª×•×š ×™×××”"], "a": "×ª×•×š ×©×¢×”", "exp": "Golden Hour."},
    {"q": "××” ×”××™× ×•×Ÿ ×©×œ ××“× ×•×–×™×Ÿ ×× ×” ×¨××©×•× ×”?", "opts": ["0.1 ×\"×’/×§\"×’", "0.2 ×\"×’/×§\"×’", "0.5 ×\"×’/×§\"×’", "1 ×\"×’/×§\"×’"], "a": "0.1 ×\"×’/×§\"×’", "exp": "×× ×” ×©× ×™×” 0.2."},
    {"q": "××” ×”×¡×›× ×” ×‘×ª×™×§×•×Ÿ ××”×™×¨ ×©×œ ×”×™×¤×•× ×ª×¨××™×”?", "opts": ["×‘×¦×§×ª ××•×—×™×ª/CPM", "××™ ×¡×¤×™×§×ª ×›×œ×™×•×ª", "×”×™×¤×¨×§×œ××™×”", "×“×™××•×"], "a": "×‘×¦×§×ª ××•×—×™×ª/CPM", "exp": "×“××™××œ×™× ×™×–×¦×™×” ×©×œ ×’×–×¢ ×”××•×—."},
    {"q": "××“×•×¢ ××™×Ÿ ×œ×ª×ª ×˜×¡×™×•×ª ×‘××©××‘×” (IVAC)?", "opts": ["×”×¨×¡ ××›×× ×™ ×©×œ ×”×˜×¡×™×•×ª", "×¡×›× ×ª ×–×™×”×•×", "××”×™×¨ ××“×™", "×¡×›× ×ª ×§×¨×™×©×”"], "a": "×”×¨×¡ ××›×× ×™ ×©×œ ×”×˜×¡×™×•×ª", "exp": "×™×© ×œ×ª×ª ×‘×’×¨×‘×™×˜×¦×™×”."},
    {"q": "××” ×”× ×•×¡×—×” ×œ×—×™×©×•×‘ × ×•×–×œ×™× ×‘×›×•×•×™×•×ª (Parkland)?", "opts": ["4 ×\"×œ * ×§\"×’ * % ×›×•×•×™×”", "2 ×\"×œ * ×§\"×’", "100 ×\"×œ ×œ×§\"×’", "×œ×¤×™ ××©×§×œ ×‘×œ×‘×“"], "a": "4 ×\"×œ * ×§\"×’ * % ×›×•×•×™×”", "exp": "×—×¦×™ ×‘-8 ×©×¢×•×ª ×¨××©×•× ×•×ª, ×—×¦×™ ×‘-16 ×”×‘××•×ª."}
]


# ==============================================================================
# 3. ×× ×•×¢ ×”×¡×™××•×œ×¦×™×” (Class) - ×ª×¨×—×™×© ××ª×’×œ×’×œ
# ==============================================================================

class SimulationEngine:
    def __init__(self):
        self.reset()
    
    def reset(self):
        self.step = 1
        self.score = 100
        self.log = []
        # ××“×“×™× ×”×ª×—×œ×ª×™×™× (×™×œ×“ ×‘×©×•×§)
        self.vitals = {"HR": 170, "BP": "75/40", "Sat": "88%", "RR": 40, "Temp": 39.5}
        self.condition = "Critical" # Critical, Unstable, Stable, Dead
        
    def update_vitals(self, intervention):
        """××¢×“×›×Ÿ ××“×“×™× ×‘×”×ª×× ×œ×¤×¢×•×œ×” ×©× ×‘×—×¨×”"""
        if intervention == "fluids_o2":
            self.vitals["HR"] -= 20
            self.vitals["BP"] = "85/50"
            self.vitals["Sat"] = "94%"
            self.log.append("âœ… × ×•×–×œ×™× ×•×—××¦×Ÿ ×©×™×¤×¨×• ××ª ×”××¦×‘ ×”×”××•×“×™× ××™.")
            self.step = 2
        
        elif intervention == "antipyretic":
            self.vitals["Temp"] = 38.0
            self.score -= 15
            self.log.append("âš ï¸ ×”×•×¨×“×ª ×—×•× ×—×©×•×‘×”, ××š ×œ× ××˜×¤×œ×ª ×‘×©×•×§ ×¢×¦××•.")
            # ×”××¦×‘ ×œ× ××©×ª×¤×¨ ×”××•×“×™× ××™×ª
            
        elif intervention == "antibiotics":
            if self.step == 2:
                self.vitals["HR"] = 120
                self.vitals["BP"] = "95/60"
                self.condition = "Stable"
                self.log.append("âœ… ×× ×˜×™×‘×™×•×˜×™×§×” ×‘×–××Ÿ ×× ×¢×” ×”×™×“×¨×“×¨×•×ª (Sepsis control).")
                self.step = 3 # × ×™×¦×—×•×Ÿ
        
        elif intervention == "wait":
            self.vitals["HR"] = 190
            self.vitals["BP"] = "60/30"
            self.condition = "Dead"
            self.score = 0
            self.log.append("âŒ ×”××ª× ×” ×’×¨××” ×œ×§×¨×™×¡×” ×§×¨×“×™×•×•×¡×§×•×œ×¨×™×ª.")
            self.step = 99 # ×”×¤×¡×“

# ××ª×—×•×œ ×”×× ×•×¢ ×‘-Session
if 'sim_engine' not in st.session_state:
    st.session_state.sim_engine = SimulationEngine()


# ==============================================================================
# 4. × ×™×”×•×œ ××©×ª××© ×•×“××˜×”
# ==============================================================================

if 'user_info' not in st.session_state: st.session_state.user_info = {}
if 'completed_topics' not in st.session_state: st.session_state.completed_topics = set()

# ==============================================================================
# 5. ×××©×§ ××©×ª××© (UI)
# ==============================================================================

# --- ×¡×¨×’×œ ×¦×“ ---
with st.sidebar:
    st.image("https://img.icons8.com/color/96/nurse-male--v1.png", width=70)
    st.markdown("<h3 style='text-align: center;'>×Ö²×—Ö¸×™×•Ö¼×ª PICU</h3>", unsafe_allow_html=True)
    
    if not st.session_state.user_info:
        st.warning("×œ× ××—×•×‘×¨")
        with st.form("login_form"):
            name = st.text_input("×©×")
            email = st.text_input("××™××™×™×œ")
            if st.form_submit_button("×›× ×™×¡×”"):
                if email:
                    st.session_state.user_info = {"name": name, "email": email}
                    st.rerun()
    else:
        st.success(f"×©×œ×•×, {st.session_state.user_info['name']}")
        
        # ×—×™×©×•×‘ ×”×ª×§×“××•×ª
        total_topics = 0
        for cat in FULL_DB.values():
            for sub in cat['subcategories'].values():
                total_topics += len(sub)
        
        done = len(st.session_state.completed_topics)
        if total_topics > 0:
            st.caption(f"×”×ª×§×“××•×ª: {int(done/total_topics*100)}%")
            st.progress(done/total_topics)

        if st.button("×™×¦×™××”"):
            st.session_state.user_info = {}
            st.rerun()
            
    st.markdown("---")
    
    # ×ª×¤×¨×™×˜ × ×™×•×•×˜
    if st.session_state.user_info:
        menu = st.radio("×ª×¤×¨×™×˜:", ["ğŸ  ×œ×•×‘×™", "ğŸ“š ××¨×›×– ×œ××™×“×”", "ğŸš‘ ×ª×¨×—×™×© ××ª×’×œ×’×œ", "âš™ï¸ × ×™×”×•×œ"])
    else:
        menu = "login_required"

# --- ×¢××•×“×™× ---

if menu == "login_required":
    st.title("××¢×¨×›×ª ×œ××™×“×” - ×˜×™×¤×•×œ × ××¨×¥ ×™×œ×“×™×")
    st.info("×× × ×”×ª×—×‘×¨ ×›×“×™ ×œ×’×©×ª ×œ×ª×›× ×™× ×”××§×¦×•×¢×™×™×.")
    
    st.markdown("""
    ### ××” ×‘××¢×¨×›×ª?
    * **×××’×¨ ×™×“×¢ ×¢×¦×•×:** ×”××˜×•××•× ×§×•×œ×•×’×™×”, ×˜×¨××•××”, ×”× ×©××”, ×ª×¨×•×¤×•×ª ×•×¢×•×“.
    * **×¡×™××•×œ×˜×•×¨:** ×ª×¨×—×™×©×™× ×§×œ×™× ×™×™× ×‘×–××Ÿ ×××ª.
    * **××‘×—× ×™×:** ×ª×¨×’×•×œ ×™×“×¢ ×œ×›×œ × ×•×©×.
    """)

elif menu == "ğŸ  ×œ×•×‘×™":
    st.markdown("<h1 style='color:#1565c0;'>××¨×›×– ×™×“×¢ ×•×¡×™××•×œ×¦×™×” - PICU</h1>", unsafe_allow_html=True)
    
    # ×›×¨×˜×™×¡×™×•×ª × ×™×•×•×˜ ××”×™×¨
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.markdown("""
        <div class='topic-card'>
            <h2>ğŸš‘</h2>
            <h3>×”×—×™×™××” ×•×©×•×§</h3>
            <p>PALS, ×¡×¤×¡×™×¡, ×˜×¨××•××”</p>
        </div>
        """, unsafe_allow_html=True)
        
    with col2:
        st.markdown("""
        <div class='topic-card'>
            <h2>ğŸ’Š</h2>
            <h3>×ª×¨×•×¤×•×ª</h3>
            <p>×¡×“×¦×™×”, ××™× ×•×˜×¨×•×¤×™×, ×× ×˜×™×‘×™×•×˜×™×§×”</p>
        </div>
        """, unsafe_allow_html=True)
        
    with col3:
        st.markdown("""
        <div class='topic-card'>
            <h2>ğŸ©¸</h2>
            <h3>×”××˜×•-××•× ×§×•×œ×•×’×™×”</h3>
            <p>TLS, ×œ×•×§××™×”, ××•×¦×¨×™ ×“×</p>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("---")
    c1, c2 = st.columns(2)
    with c1:
        st.info("ğŸ’¡ **×˜×™×¤:** ×‘×ª×™×§×•×Ÿ ×”×™×¤×•×§×œ××™×” ×•×”×™×¤×•××’× ×–××™×” - ×ª×§×Ÿ ××’× ×–×™×•× ×§×•×“×!")
    with c2:
        st.warning("âš ï¸ **×‘×˜×™×—×•×ª:** ××™×Ÿ ×œ×ª×ª ×˜×¡×™×•×ª ×‘××©××‘×ª IVAC (×”×¨×¡ ××›×× ×™).")

elif menu == "ğŸ“š ××¨×›×– ×œ××™×“×”":
    st.title("ğŸ“š ×”×¡×¤×¨×™×™×” ×”××§×¦×•×¢×™×ª")
    
    # ×©×œ×‘ 1: ×‘×—×™×¨×ª ×§×˜×’×•×¨×™×” ×¨××©×™×ª
    categories = list(FULL_DB.keys())
    selected_cat = st.selectbox("×‘×—×¨ ×ª×—×•×:", categories)
    
    cat_data = FULL_DB[selected_cat]
    st.caption(cat_data['description'])
    
    # ×©×œ×‘ 2: ×‘×—×™×¨×ª ×ª×ª-×§×˜×’×•×¨×™×”
    subcats = list(cat_data['subcategories'].keys())
    selected_subcat = st.radio("× ×•×©×:", subcats, horizontal=True)
    
    # ×©×œ×‘ 3: ×‘×—×™×¨×ª ×¤×¨×•×˜×•×§×•×œ ×¡×¤×¦×™×¤×™
    protocols = cat_data['subcategories'][selected_subcat]
    protocol_names = list(protocols.keys())
    
    # ×›×¤×ª×•×¨×™× ×œ×¤×¨×•×˜×•×§×•×œ×™×
    st.markdown("---")
    cols = st.columns(3)
    for i, p_name in enumerate(protocol_names):
        status = "âœ…" if p_name in st.session_state.completed_topics else "â­•"
        if cols[i % 3].button(f"{status} {p_name}", use_container_width=True):
            st.session_state.current_protocol = p_name
            
    # ×”×¦×’×ª ×”×ª×•×›×Ÿ
    if 'current_protocol' in st.session_state and st.session_state.current_protocol in protocols:
        p_name = st.session_state.current_protocol
        p_data = protocols[p_name]
        
        # ××™×›×œ ×”×ª×•×›×Ÿ ×”×¨××©×™
        st.markdown("<div class='content-container'>", unsafe_allow_html=True)
        
        # ×¨×™× ×“×•×¨ HTML × ×§×™
        html_content = render_clean_html(p_data['text'])
        st.markdown(html_content, unsafe_allow_html=True)
        
        # ×ª××•× ×”
        if p_data.get('image'):
            st.image(p_data['image'], width=400)
            
        st.markdown("</div>", unsafe_allow_html=True)
        
        # ××–×•×¨ ×¡×™×•× ×•×ª×¨×’×•×œ
        c_done, c_quiz = st.columns(2)
        
        with c_done:
            is_done = p_name in st.session_state.completed_topics
            if st.checkbox("×¡×™×™××ª×™ ×œ×œ××•×“ × ×•×©× ×–×” âœ…", value=is_done, key=p_name):
                st.session_state.completed_topics.add(p_name)
            else:
                st.session_state.completed_topics.discard(p_name)
                
        with c_quiz:
            with st.expander("ğŸ“ ×‘×—×Ÿ ××ª ×¢×¦××š"):
                # ×¡×™× ×•×Ÿ ×©××œ×•×ª ×¨×œ×•×•× ×˜×™×•×ª (×œ×¤×™ ××™×œ×•×ª ××¤×ª×— ×›×™ ××™×Ÿ ×§×™×©×•×¨ ×™×©×™×¨ ×‘×“××• ×”×–×”)
                relevant_qs = [q for q in ALL_QUESTIONS if p_name.split()[0] in q['q'] or p_name.split()[0] in q['exp']]
                
                if not relevant_qs: # ×× ××™×Ÿ ×¡×¤×¦×™×¤×™, ×ª×‘×™× ×¨× ×“×•××œ×™ ×›×œ×œ×™
                    relevant_qs = random.sample(ALL_QUESTIONS, 1)
                
                q = random.choice(relevant_qs)
                st.write(f"**{q['q']}**")
                ans = st.radio("×ª×©×•×‘×”:", q['opts'], key=f"q_{p_name}")
                
                if st.button("×‘×“×™×§×”", key=f"btn_{p_name}"):
                    if ans == q['a']:
                        st.success("× ×›×•×Ÿ ×××•×“!")
                    else:
                        st.error(f"×˜×¢×•×ª. ×”×ª×©×•×‘×” ×”×™×: {q['a']}")
                        st.info(q['exp'])

elif menu == "ğŸš‘ ×ª×¨×—×™×© ××ª×’×œ×’×œ":
    st.title("ğŸš‘ ×¡×™××•×œ×¦×™×”: × ×™×”×•×œ ×”×œ× (Shock)")
    
    sim = st.session_state.sim_engine
    
    # ×¡×¨×’×œ ×›×œ×™×
    if st.button("ğŸ”„ ×”×ª×—×œ ×¡×™××•×œ×¦×™×” ××—×“×©"):
        sim.reset()
        st.rerun()
    
    # ×ª×¦×•×’×ª ××•× ×™×˜×•×¨
    st.markdown(f"""
    <div class="sim-monitor">
        <div><div class="sim-value">{sim.vitals['HR']}</div><div class="sim-label">HR</div></div>
        <div><div class="sim-value">{sim.vitals['BP']}</div><div class="sim-label">NIBP</div></div>
        <div><div class="sim-value">{sim.vitals['Sat']}</div><div class="sim-label">SPO2</div></div>
        <div><div class="sim-value" style="color:{'#f00' if sim.condition=='Critical' else '#0f0'}">{sim.condition}</div><div class="sim-label">STATUS</div></div>
    </div>
    """, unsafe_allow_html=True)
    
    # ×œ×•×’×™×§×ª ×©×œ×‘×™×
    if sim.step == 1:
        st.markdown("""
        ### ğŸ›‘ ×§×‘×œ×ª ×—×•×œ×”
        ×‘×Ÿ 3 ×©× ×™×. ×”×’×™×¢ ×¢×§×‘ ×™×©× ×•× ×™×•×ª ×•×—×•× ×’×‘×•×”.
        ×‘×‘×“×™×§×”: ×—×™×•×•×¨, ×’×¤×™×™× ×§×¨×•×ª, ××™×œ×•×™ ×§×¤×™×œ×¨×™ 4 ×©× ×™×•×ª, × ×©×™××•×ª ×©×˜×—×™×•×ª ×•××”×™×¨×•×ª.
        **××” ×”×¤×¢×•×œ×” ×”×¨××©×•× ×” ×©×œ×š?**
        """)
        
        c1, c2 = st.columns(2)
        if c1.button("××ª×Ÿ ××§××•×œ ×œ×”×•×¨×“×ª ×—×•×"):
            sim.update_vitals("antipyretic")
            st.rerun()
            
        if c2.button("×—××¦×Ÿ + ×‘×•×œ×•×¡ × ×•×–×œ×™× 20 ×\"×œ/×§\"×’"):
            sim.update_vitals("fluids_o2")
            st.rerun()
            
    elif sim.step == 2:
        st.markdown("""
        ### âš ï¸ ×”×¢×¨×›×” ×—×•×–×¨×ª
        ×”×™×œ×“ ×§×™×‘×œ ×‘×•×œ×•×¡ × ×•×–×œ×™×. ×”×“×•×¤×§ ×™×¨×“ ××¢×˜ ××š ×¢×“×™×™×Ÿ ×˜×›×™×§×¨×“×™.
        ×”×ª×§×‘×œ×” ×¡×¤×™×¨×ª ×“×: ×œ×•×™×§×•×¦×™×˜×™× 25,000. ×œ×§×˜×˜ ×‘×“×: 5.0.
        **×—×©×“ ×§×œ×™× ×™: ×©×•×§ ×¡×¤×˜×™.**
        
        ××” ×”×¦×¢×“ ×”×§×¨×™×˜×™ ×”×‘× (Golden Hour)?
        """)
        
        c1, c2 = st.columns(2)
        if c1.button("×œ×”××ª×™×Ÿ ×œ×ª×•×¦××•×ª ×ª×¨×‘×™×ª ×“× ×¡×•×¤×™×•×ª"):
            sim.update_vitals("wait")
            st.rerun()
            
        if c2.button("×× ×˜×™×‘×™×•×˜×™×§×” ×¨×—×‘×ª ×˜×•×•×— (IV) ××™×“"):
            sim.update_vitals("antibiotics")
            st.rerun()
            
    elif sim.step == 3:
        st.balloons()
        st.success(f"ğŸ‰ ×›×œ ×”×›×‘×•×“! ×”×¦×œ×ª ××ª ×”×™×œ×“. ×”×¦×™×•×Ÿ ×©×œ×š: {sim.score}")
        st.markdown("### ×¡×™×›×•× ××™×¨×•×¢:")
        for log in sim.log:
            st.write(log)
            
    elif sim.step == 99:
        st.error("ğŸ’€ ×”×™×œ×“ ×§×¨×¡. ×”×¡×™××•×œ×¦×™×” × ×›×©×œ×”.")
        st.write("×¡×™×‘×”: ×¢×™×›×•×‘ ×‘××ª×Ÿ ×˜×™×¤×•×œ ×§×¨×™×˜×™ (× ×•×–×œ×™×/×× ×˜×™×‘×™×•×˜×™×§×”) ×”×•×‘×™×œ ×œ×›×©×œ ×¨×‘ ××¢×¨×›×ª×™.")

elif menu == "âš™ï¸ × ×™×”×•×œ":
    st.title("×××©×§ ×× ×”×œ")
    
    if st.session_state.user_info.get('email') == 'yishaycopp@gmail.com':
        st.success("×–×•×”×” ×× ×”×œ ××¢×¨×›×ª âœ”ï¸")
        
        t1, t2 = st.tabs(["×¢×¨×™×›×ª ×ª×•×›×Ÿ", "×”×•×¡×¤×ª ×©××œ×”"])
        
        with t1:
            # ×‘×—×™×¨×ª × ×ª×™×‘ ×œ×¢×¨×™×›×”
            cat = st.selectbox("×ª×—×•×:", list(FULL_DB.keys()))
            sub = st.selectbox("×ª×ª-×ª×—×•×:", list(FULL_DB[cat]['subcategories'].keys()))
            prot = st.selectbox("×¤×¨×•×˜×•×§×•×œ:", list(FULL_DB[cat]['subcategories'][sub].keys()))
            
            # ×¢×¨×™×›×”
            current_text = FULL_DB[cat]['subcategories'][sub][prot]['text']
            new_text = st.text_area("×¢×¨×•×š ×˜×§×¡×˜ (Markdown)", value=current_text, height=400)
            
            if st.button("×©××•×¨ ×©×™× ×•×™×™×"):
                FULL_DB[cat]['subcategories'][sub][prot]['text'] = new_text
                st.toast("×”×©×™× ×•×™×™× × ×©××¨×• ×‘×”×¦×œ×—×” (×–×× ×™×ª ×œ-Session ×–×”)")
                
    else:
        st.error("××™×Ÿ ×œ×š ×”×¨×©××” ×œ×¦×¤×•×ª ×‘×“×£ ×–×”.")
